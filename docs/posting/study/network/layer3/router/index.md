---
tags: [network, layer3, router]
title: Router
author: ndy2
---

 
> [!quote] 참고 자료
> - 비전공개발자 주니 키우기 - [그림으로 배우는 네트워크 원리 스터디 영상](https://youtu.be/aRv1NWdYKfs)
> - baeldung cs - [routing table entry](https://www.baeldung.com/cs/routing-table-entry)
> - geeksforgeeks - [what is frame check sequence?](https://www.geeksforgeeks.org/what-is-frame-check-sequence/)

### 1. 라우팅, 라우터란?

> [!note] Network Routing - 라우팅이란?
> - 라우팅은 에트워크에서 경로를 선택하는 프로세스입니다. 
> - 라우팅을 통해 네트워크 통신의 효율성을 높일 수 있습니다.

![[images/routing.png]]

> [!note] Network Router - 라우터란?
> - 라우터는 OSI 7계층에서 네트워크 계층에 포함되는 기기입니다. 
>  - 논리적으로 분리된 망, 혹은 물리적으로 분리된 망 사이를 지나가야 하는 패킷들에게 경로를 뽑아 자기가 아는 최선의 경로를 찾아낸 뒤 (라우팅, 경로설정) 다른 망으로 패킷을 보내주는 역할 (포워딩, 스위칭) 을 하는 기계입니다. 

> [!note] 라우터의 종류
> 라우터의 종류는 네트워크에서 사용되는 위치나 규모에 따라 다양합니다. ISP 의 랜이나 여러개의 ISP network 를 연결하는 `코어 라우터` 에서부터 흔히 포켓 와이파이로 알려진 `모바일 라우터`에 이르기 까지 다양한 종류가 있습니다. 하지만 기본적인 기능은 모두 같습니다.
> 
> 라우터의 기능을 클라우드에서 가상화하여 소프트웨어로 제공하는 가상 라우터도 있습니다.

### 2. 라우팅 동작, 라우팅 테이블이란?

> [!note] 라우팅은 어떻게 동작하나요?
> 데이터 패킷이 도착하면 라우터는 먼저 라우팅 테이블에서 목적지의 주소를 찾습니다. 그 다음 라우터는 패킷을 네트워크의 다음 지점으로 전달합니다.
> 
> 예를 들어 사무실 네트워크에서 웹 사이트를 방문하면, 데이터 패킷이 먼저 사무실 네트워크 라우터로 이동합니다. 라우터가 헤더 패킷을 조회하고 패킷 대상을 결정합니다. 그 다음 내부 테이블을 조회하고, 네트워크 자체 내에서 패킷을 다음 라우터로 전달하거나 프린터와 같은 다른 디바이스로 전달합니다.

> [!note] 라우팅 테이블이란?
> 라우터가 라우팅 테이블을 만드는 방식에 따라 라우팅은 두가지 유형으로 구분 됩니다. 네트워크 관리자가 네트워크 설계나 파라미터를 사전에 분석하여 정적으로 테이블을 구축하는 방식과 런타임에 동적으로 스스로 업데이트 되는 방식입니다. - 정적 라우팅 (테이블)과 동적 라우팅 (테이블)
> 
> 동적 라우팅 테이블은 현재의 망 상태 및 구성 현황이 반영된 최적의 경로정보들로 항상 갱신하는 방식입니다. 
> 
> 이를 위해 각 라우터들은 다른 라우터와의 라우팅 정보를 교환하는데 이러한 라우팅 정보 교환용 프로토콜을 ***라우팅 프로토콜***<sup>Routing Protocol</sup> 이라 하며 RIP, IGRP, OSPF, ISIS, BGP 등이 있습니다.

### 3. 라우팅 동작

![[excalidraws/routing-process-1.excalidraw.png]]

라우팅 과정은 라우터가 패킷을 받으며 시작합니다. 라우터는 라우팅 테이블에 따라 목적지로 보내기 위한 다음 디바이스의 IP 주소 즉, ***넥스트 홉***<sup>Next Hope</sup> 을 결정합니다.

라우팅 과정에서 변하는 것은 세가지 입니다.

- 이더넷 헤더 (MAC 주소)
- FCS (Frame Check Sequence)
- TTL : -1 

> [!note] 이더넷 헤더
> 각 디바이스는 ARP 프로토콜을 통해 인접한 라우터, 호스트의 MAC 주소를 알고 있습니다. 패킷의 이더넷 헤더에 담긴 출발지, 도작지 MAC 주소 정보는 매 링크, 홉, 마다 바뀝니다!

> [!note] FCS - Frame Check Sequence
> FCS 는 전송되는 동안 오류가 났는지 체크하는 부분입니다. Frame 의 뒤에 붙습니다. 에러를 검출하기 위한 용도이지 에러를 복구하는 용도가 아닙니다!

> [!note] TTL - Time To Live
> TTL 은 IP 헤더의 필드이며 컴퓨터나 네트워크에서 데이터의 유효기간을 나타내기 위한 방법입니다.
> 정해지 유효기간이 지나면 패킷을 패키하는 방식으로 패킷이 네트워크에서 무한 순환하는 것을 방지합니다.
> TTL 필드가 0 이 되면 라우터는 해당 패킷을 버립니다. 그리고 송신 호스트에게 `ICMP time exceeded` 메시지를 보냅니다. 송신 호스트는 ICMP time exceeded 메시지를 수신하면 TTL 을 조정하여 다시 패킷을 전송하고 해당 라우터를 거쳐갔는지 확인합니다.

### 4. 라우팅 테이블

![[images/routing-table.png]]

**`라우팅 테이블`**

위 라우팅 테이블의 엔트리를 해석하면 다음과 같습니다.

```
1. 101.25.67.0 이 목적지인 패킷을 받으면 eth3 인터페이스를 통해 10.0.0.2 게이트웨이 로 전달해라
2. 라우팅 테이블에서 목적지 IP 를 찾지 못하면 eh0 인터페이스를 통해 10.0.0.1 게이트웨이 로 전달해라
3. ...
```
